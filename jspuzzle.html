<style>
    button {
        width: 190px;
    }
    .card {
        margin: 5px;
        width: 150px;
        word-wrap: normal;
    }
    /* Tooltip container */
    .tooltip {
    position: relative;
    display: inline-block;
    border-bottom: 1px dotted black; /* If you want dots under the hoverable text */
    }

    /* Tooltip text */
    .tooltip .tooltiptext {
    visibility: hidden;
    background-color: black;
    color: #fff;
    text-align: center;
    padding: 5px;
    border-radius: 6px;
    
    /* Position the tooltip text - see examples below! */
    position: absolute;
    z-index: 1;
    }

    /* Show the tooltip text when you mouse over the tooltip container */
    .tooltip:hover .tooltiptext {
    visibility: visible;
    }
</style>
<div style="display: flex;">
    <div style="width: 200px; height: 600px; display: inline-block;" id="questionBox">
        <button id="mainmenu">About this game</button>
    </div>
    <div style="width: 900px; height: 600px; display: inline-block; ">
        <div>
            <p id=question></p>
        </div>
        <textarea name="" id="code" cols="120" rows="20">//write your code here</textarea><button id="submit">Submit</button>
        <div id="scorearea"></div>
    </div>
</div>
<script>
    questions = [];
</script>
<script src="questions/question2.js"></script>
<script src="questions/question3.js"></script>
<script src="questions/question1.js"></script>
<script>
    let mm = document.querySelector('#mainmenu');
    mm.onclick = function(){
        document.querySelector("#code").setAttribute("style",'display: none; margin: 5px;');
        document.querySelector("#submit").setAttribute("style",'display: none;');
        document.querySelector('#scorearea').innerHTML = "";
        document.querySelector("#question").innerHTML = `
        in this game you are ask to code simple programs / algorithms. The problem is you have to complete it with constraint:<br/>
        each character you type require you to pay a cost (few first ones are free)<br/>
        can you manage to optimize the cost whilst still completing the program?`;
    };
</script>
<script>
    document.querySelector('#questionBox');
    let qbox = document.querySelector('#questionBox');
    for (const q of questions) {
        let qbtn = document.createElement("button");
        qbtn.setAttribute("id", q.name);
        qbtn.innerText = q.name;
        qbtn.check = q.check;
        qbtn.onclick = function () {
            document.querySelector("#code").setAttribute("style",'display: block; margin: 5px;');
            document.querySelector("#submit").setAttribute("style",'display: block;');
            document.querySelector("#code").value="";
            let sbmt = document.querySelector("#submit");
            let scoring = function (code) {
                let res = {
                    score: q.credits || 100,
                    items: {}
                };
                for (const score of q.scoring) {
                    let n = score.name;
                    console.log("scoring "+n);
                    res.items[n] = {
                        count: 0
                    };
                    if(score.default){
                        res.items[n].count = code.length;
                        code = "";
                    }else{
                        for (const t of score.items) {
                            console.log("scanning for "+t);
                            let x = false;
                            do {
                                x = false;
                                if (code.indexOf(t) >= 0) {
                                    res.items[n].count++;
                                    x = true;
                                    console.log("deleting "+t);
                                    console.log("code now is "+code);
                                    console.log("count for "+n+" is "+res.items[n].count)
                                }
                                code = code.replace(t, "");
                                console.log(code.length);
                            } while (x);
                            if (code.length == 0) break;
                        }
                    }
                    let extra = res.items[n].count - score.free;
                    res.items[n].free = score.free;
                    res.items[n].startingPrice = score.startingPrice;
                    res.items[n].increment = score.increment;
                    res.items[n].items = score.items;
                    res.items[n].default = score.default?true:false;
                    res.items[n].totalPrice = extra>0?(extra*(2*score.startingPrice+(extra-1)*score.increment))/2:0;
                    res.score=res.score-res.items[n].totalPrice;
                }
                return res;
            }
            document.querySelector('#code').onkeydown = function(){
                let scr = scoring(document.querySelector('#code').value);
                let s = "<h2>your credits: </h2><h1>"+scr.score+"</h1>";
                let t = '<div style="display: inline-flex;">';
                for(const itemName in scr.items){
                    let item = scr.items[itemName];
                    let u = "<div class=\"card\"><h4>"+itemName+'</h4>';
                    if(!item.default){
                        u+='<div class="tooltip">view set<br /><div class="tooltiptext">'
                        u+=''+item.items+'</div></div>'
                    }
                    u+='<table><tr><td>count</td><td>'+item.count+'</td></tr>';
                    u+='<tr><td>free</td><td>'+item.free+'</td></tr>';
                    let extra = item.count - item.free;
                    let nextPrice = extra>0?item.startingPrice+extra*item.increment:item.startingPrice;
                    u+='<tr><td>next price</td><td>'+nextPrice+'</td></tr>';
                    u+='<tr><td>total cost</td><td>'+item.totalPrice+'</td></tr></table></div>';
                    t+=u;
                }
                t+="</div>";
                s = s+"<div>"+t+"</div>";
                document.querySelector('#scorearea').innerHTML=s;
            };
            document.querySelector('#code').onchange=document.querySelector('#code').onkeydown
            sbmt.onclick = function () {
                try {
                    eval("code = " + document.querySelector("#code").value);
                    q.check(code);
                    alert("success!");
                } catch (e) {
                    alert(e);
                    throw (e);
                } finally {
                    delete code;
                }
            }
            document.querySelector('#code').onchange()
            document.querySelector("#question").innerHTML = q.description;
        }
        qbox.appendChild(qbtn);
    }
    delete questions;
    document.querySelector('#mainmenu').click();
</script>